{% extends "base.html" %}
{% load problem crispy_forms_tags gravatar i18n %}

{% block "bodyclass" %}problem{% endblock %}

{% block "head" %}{{ form.media }}{% endblock %}

{% block "content" %}

    <div class="row problem-detail-title">
    <div class="columns content large-12">
        <h4>{{ problem.title }}</h4>
    </div>
    </div>

    <div class="row">
    <div class="columns large-9 problem-detail">

        <div class="description">
            {{ problem.description|safe }}
        </div>

        <hr/>
        {% if user_ideas_left > 0 %}
            <a class="problem-idea-button problem-idea-form-button large button expand">{% trans "Submit your idea to this problem" %}{% if problem.max %}<br/><small>{% blocktrans count user_ideas_left as ideas %}you have {{ ideas }} idea left{% plural %}you have {{ ideas }} ideas left{% endblocktrans %}</small>{% endif %}</a>
        {% else %}
            <a class="problem-idea-button large button expand secondary" disabled="disabled">{% trans "You contributed with the maximum ideas allowed for this problem" %}<br/><small>{% trans "edit or delete your existing ideas if you change your mind about them" %}</small></a>
        {% endif %}
        <div class="problem-idea-form">
            <h5>{% trans "Your idea" %}</h5>
            {% crispy form %}
        </div>
        <hr/>

        {% if ideas %}
        <a name="problem-ideas"></a>
        <div class="problem-ideas">
            <h4>{% trans "Submitted ideas" %}</h4>
            {% for idea in ideas %}

                <div class="idea" id="idea-{{ idea.id }}">

                    <div class="row collapse">
                    {% if problem.voting %}
                        <div class="columns large-1 voting">
                            <a class="button secondary upvote{% if idea.user_vote.weight == 1 %} success{% endif %}" data-idea="{{ idea.id }}"{% if idea.user == request.user %} disabled="disabled"{% endif %}><i class="foundicon-thumb-up"></i></a>
                            {% if problem.vote_count %}<span class="vote-count">{{ idea.vote_count }}</span>{% endif %}
                            <a class="button secondary downvote{% if idea.user_vote.weight == -1 %} alert{% endif %}" data-idea="{{ idea.id }}"{% if idea.user == request.user %} disabled="disabled"{% endif %}><i class="foundicon-thumb-down"></i></a>
                        </div>
                    {% endif %}
                    <div class="columns large-{% if problem.voting %}11{% else %}12{% endif %}">
                        {{ idea.content|safe }}
                    </div>
                    </div>

                    <div class="row">
                    <div class="columns large-5 large-offset-7">

                        <div class="user-box alignright">
                            <div class="row collapse">
                            <div class="columns large-10">
                                <a class="contributed" href="{{ request.get_full_path }}#idea-{{ idea.id }}">{% trans "contributed" %} {{ idea.modified|date:"d b Y" }} {% trans "at" %} {{ idea.modified|date:"H:i" }}</a><br/>
                                <a class="username" href="{% url "user" request.user.id %}">{{ idea.user.username }}</a>
                            </div>
                            <div class="columns large-2">
                                <a class="avatar"><img src="{% gravatar_for_user idea.author 32 %}" /></a>
                            </div>
                            </div>
                        </div>

                    </div>
                    </div>

                </div>
                <hr/>
            {% endfor %}
        </div>
        {% endif %}

    </div>

    <div class="columns sidebar large-3">
        {% include "problem_sidebar.html" %}
    </div>

    </div>


{% endblock %}
