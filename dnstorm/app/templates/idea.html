{% load crispy_forms_tags humanize i18n %}

<div class="problem-idea" data-idea="{{ idea.id }}">

    <div class="row">

        <div class="columns large-12">

            {# Content #}

            <div class="row">
                {% if show_likes %}
                    <div class="idea-like{% if not user.is_authenticated %}-disabled{% endif %} columns large-1 medium-2 small-3{% if idea.voted %} voted{% endif %}" data-idea="{{ idea.id }}" data-counter="{{ idea.vote_count }}">
                        <a class="idea-like-bulb"><i class="fi-lightbulb"></i></a>
                        <span class="idea-like-counter">{{ idea.vote_count }}</span>
                    </div>
                {% endif %}
                <div class="idea-content columns{% if show_likes %} large-11 medium-10 small-9{% else %} large-12{% endif %}">

                    <h4><a href="{{ idea.get_absolute_url }}" id="idea-{{ idea.id }}">{{ idea.title }}</a></h4>
                    {{ idea.content|safe }}

                    {# Criterias with stars #}

                    <div class="row">
                        <div class="columns large-12 idea-criterias">
                        {% for criteria in idea.criterias %}
                            {% include "criteria_button.html" with criteria=criteria size="tiny" with_stars=True with_link=False %}
                        {% endfor %}
                        </div>
                    </div>

                    {# Action mini bar #}

                    <div class="row">

                        <div class="columns large-6">
                            <div class="row collapse">
                                <div class="columns large-12 right idea-actions">
                                    {% if show_actions %}

                                        {% if problem_perm_contribute %}
                                            <a class="problem-action action-comment" data-idea="{{ idea.id }}" href="javascript:void(0);"><i class="fi-comments"></i>&nbsp;{% trans "Comment" context "verb" %}</a>
                                        {% endif %}
                                        {% if problem_perm_manage or problem_perm_edit %}
                                            <a class="problem-action problem-idea-edit" href="{% url "idea_update" problem.slug idea.id %}"><i class="fi-pencil"></i>&nbsp;{% trans "Edit" %}</a>
                                        {% endif %}
                                        {% if problem_perm_manage %}
                                            <a class="problem-action problem-idea-delete-toggle idea-delete" href="javascript:void(0);" data-idea="{{ idea.id }}"><i class="fi-x"></i>&nbsp;{% trans "Delete" %}</a>
                                        {% endif %}

                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        {% if idea.coauthor_ %}
                            <div class="columns medium-3 large-3">
                                <small>{% trans "edited" %}</small>
                                {% include "user_box.html" with clean=True user=idea.coauthor_ date=idea.updated link=idea.get_absolute_url %}
                            </div>
                        {% endif %}
                        <div class="columns medium-3 large-3">
                            {% if idea.coauthor_ %}<small>{% trans "created" %}</small>{% endif %}
                            {% include "user_box.html" with user=idea.author date=idea.created link=idea.get_absolute_url %}
                        </div>

                    </div>

                    {# Comment form #}

                    {% if problem_perm_contribute %}
                        <div class="comment-form hide" id="comment-form-idea-{{ idea.id }}" data-idea="{{ idea.id }}"></div>
                    {% endif %}

                    {# Comments #}

                    {% if show_comments %}

                        <div class="comments" id="comments-idea-{{ idea.id }}">
                            {% if idea.comments %}
                                {% for comment in idea.comments %}
                                    {% if forloop.counter > 3 %}
                                        {% include "comment.html" with hidden=True %}
                                    {% else %}
                                        {% include "comment.html" %}
                                    {% endif %}
                                {% endfor %}
                                {% if idea.comments.count > 3 %}
                                    <div class="row collapse comment display-more">
                                        <div class="columns large-12">
                                            <div class="comment-content">
                                                <a href="javascript:void(0)"><i class="fi-arrow-down"></i>&nbsp;{% blocktrans with count=idea.comments.count|add:"-3" %}Display the other <b>{{ count }}</b> comments.{% endblocktrans %}</a>
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                            {% endif %}
                        </div>

                    {% endif %}

                </div>
            </div>

        </div>

    </div>
</div>
